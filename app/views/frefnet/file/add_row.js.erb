<% filerowId = "#{params.fetch(:id)}-#{SecureRandom.hex(4)}" %>

var uploadContainer = $('#multiple-file-upload')

generateFileUploadRow()

function generateFileUploadRow() {
  addRow();
  addHiddenFieldToForm("<%= params.fetch(:form_id) %>")
}

function addHiddenFieldToForm(formId) {
  var form = $('#' + formId);

  var input = "<%= f.hidden_field :frefnet_file_references, id: "#{params.fetch(:id)}-#{filerowId}" %>"

  input.appendTo(form);
//  $('<input>').attr({
//    type: 'hidden',
//    name: 'frefnet_file_references',
//    id: "<%#= "#{params.fetch(:id)}-#{filerowId}" %>"
//  }).appendTo(form);
}

function addRow() {
  var fileRow = "<%= j render 'shared/multiple_file_upload_row', id: filerowId, required: true, class: 'form-control' %>"

  uploadContainer.append(fileRow);
}

$(document).ready(function () {
  new App.Lib.FileUploader({
    frefnetPresignUploadPath: '<%= frefnet.file_presign_upload_path %>',
    fileUploadId: "<%= filerowId %>",
    frefnetCallback: function (fileRefId) {
      $("<%= "##{params.fetch(:id)}-#{filerowId}" %>").val(fileRefId);
    }
  });
})