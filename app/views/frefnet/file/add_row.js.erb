generateFileUploadRow()

function generateFileUploadRow() {
  addRow();
  addHiddenFieldToForm("<%= params.fetch(:form_id) %>")
}

function addHiddenFieldToForm(formId) {
  var form = $('#' + formId);

  $('<input>').attr({
    type: 'hidden',
    name: 'frefnet-file-references',
    id: "<%= params.fetch(:id) %>-field"
  }).appendTo(form);
}

function addRow() {
  var uploadContainer = $('#multiple-file-upload')
  var fileRow = "<%= j render 'shared/multiple_file_upload_row', id: params.fetch(:id), required: true, class: 'form-control' %>"

  uploadContainer.append(fileRow);
}

$(document).ready(function () {
  new App.Lib.FileUploader({
    frefnetPresignUploadPath: '<%= frefnet.file_presign_upload_path %>',
    fileUploadId: "<%= params.fetch(:id) %>",
    frefnetCallback: function (fileRefId) {
      $('#' + "<%= params.fetch(:id) %>-field").val(fileRefId);
    }
  });
})